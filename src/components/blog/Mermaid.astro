---
interface Props {
  code: string
}

const { code } = Astro.props
---

<pre class="mermaid">
  {code}
</pre>

<script>
  // import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs'
  import mermaid from 'mermaid'

  // 只执行一次的全局配置
  mermaid.initialize({
    startOnLoad: true,
    themeVariables: {
      fontSize: '24px',
    },
    look: 'handDrawn',
  })

  // 用于重新渲染图表的函数
  async function renderMermaid() {
    try {
      await mermaid.run()
    } catch (error) {
      console.error('Mermaid 渲染失败:', error)
    }
  }

  // 监听 view transition 事件
  document.addEventListener('astro:after-swap', renderMermaid)
</script>
