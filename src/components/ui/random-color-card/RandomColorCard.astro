---
import { Card } from '@eliancodes/brutal-ui'
---

<div class="brutal-card-container">
  <Card color="#a78bfa">
    <slot />
  </Card>
</div>

<script>
  import { pageColor } from '@store/theme'

  const colors = [
    '#c084fc',
    '#f472b6',
    '#fb7185',
    '#e879f9',
    '#a78bfa',
    '#818cf8',
    '#60a5fa',
    '#38bdf8',
    '#22d3ee',
    '#2dd4bf',
    '#34d399',
    '#4ade80',
    '#a3e635',
    '#facc15',
    '#fb923c',
    '#f87171',
  ]

  function updateColor(pageColor: string | undefined) {
    const cards = document.querySelectorAll('.brutal-card-container > .brutal-card')
    if (!cards.length) return

    const filteredColors = pageColor ? colors.filter((color) => color !== pageColor) : colors
    cards.forEach((card) => {
      const randomColor = filteredColors[Math.floor(Math.random() * filteredColors.length)]
      ;(card as HTMLElement).style.backgroundColor = randomColor
    })
  }

  function updateColorSubscription() {
    pageColor.subscribe((currentPageColor: string | undefined) => {
      updateColor(currentPageColor)
    })
  }

  ;['DOMContentLoaded', 'astro:after-swap'].forEach((eventName) => {
    document.addEventListener(eventName, updateColorSubscription)
  })
</script>
